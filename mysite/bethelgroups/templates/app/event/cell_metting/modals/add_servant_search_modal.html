<!-- Modal Structure -->
<div id="servant-modal" class="modal modal-fixed-footer" >
    
    <div class="modal-content">
        <h4>Adicionar Servo</h4>

        <div class="row">
       
           

            <div class="input-field col s12">
                <div class="autocomplete" id="single">
                    <div class="ac-input">
                        <input type="text" id="servosSearch"  placeholder="Please input some letters" data-activates="singleDropdown" data-beloworigin="true" autocomplete="off">
                    </div>
                    <ul id="singleDropdown" class="dropdown-content ac-dropdown"></ul>
                </div>
                <label class="active" for="servosSearch">Buscar pessoa: </label>
            </div>

            <div class="input-field col s12">

                <div class="collection" id="result-search-users">


                </div>

            </div>

            <div class="input-field col s12">
                <!--<select multiple id="cell-role{{ fields_seq }}-multiple" name="cell-role{{ fields_seq }}-multiple">-->
                <select multiple id="cell-role-multiple" name="cell-role-multiple">
                  <option id="selected-role" value="" disabled selected>Selecione</option>

                      {% for item in Roles %}                    
                        <option value="{{ item.id }}">{{ item.name }}</option>
                      {% endfor %} 

                </select>
                <label>Função</label>

            </div>


            <input type="hidden" id="user_searched_selected" />
            <input type="hidden" id="user_role_selected" />

        </div>

    </div>


    <div class="modal-footer">
        <a id="ok_modal" href="#!" onclick="window.cancel_modal = false;close_modal();" class=" waves-effect waves-green btn-flat">OK</a>
        <a href="#!" onclick="window.cancel_modal = true" class=" modal-action modal-close waves-effect waves-green btn-flat">Cancelar</a>        
    </div>


</div>


<script>

        function close_modal(){
                user_selected = $('#user_searched_selected').val();
                roles_selected = $('#cell-role-multiple').val();

                if (user_selected == ''){
                    alert('Selecione um usuario!');

                    return false;
                }

                if (roles_selected == ''){
                    alert('Selecione uma ou mais funções!');

                    return false;
                }

                user_selected = $('#user_searched_selected').val();
                roles_selected = $('#cell-role-multiple').val();


                $('#loader-servant-cell-added').show();                    

                $.ajax({
                    method: "GET",
                    dataType: "html",
                    url: "{{ base_url }}/add_servant_list_presence",
                    data: { userid: user_selected, rolesid: roles_selected}
                    })
                    .fail(function(){
                        $('#loader-servant-cell-added').hide();
                    })                        
                    .done(function( msg ) {

                        $('#servant-cell-added').append(msg);

                        $('#loader-servant-cell-added').hide();
                    });


                $('#servant-modal').closeModal();

        }

    
        $(function () {
            var single = $('#servosSearch').materialize_autocomplete({
                multiple: {
                    enable: false
                },

                dropdown: {
                    el: '#singleDropdown-removethis'
                },

                hidden: {
                    enable: true,
                    el: "#userid",
                },

                onSelect: function (item) {
                    alert('selected '+item.id)
                },

                getData:function(value, callback){

                    $.ajax({
                        method: "GET",
                        dataType: "html",
                        url: "{{ base_url }}/get_servant_autocomplete",
                        data: { send: value }
                        })
                        .always(function(){
                            //loading
                        })
                        .done(function( msg ) {

                            $('#result-search-users').html('');
                            $('#result-search-users').append(msg);                                

                        });


                }

            });

        }); 


        $('#servosSearch').blur(function(){
          
                $('#servosSearch').val('');
        });


</script>